# Release v2.0.1 - Unified Knowledge Base & Bug Fixes

## ğŸ¯ Commit Message

```
Release v2.0.1: Unified Knowledge Base Architecture & Critical Bug Fixes

Major Changes ä¸»è¦å˜æ›´:
- é‡æ„çŸ¥è¯†åº“ä¸ºç»Ÿä¸€æ‰å¹³ç»“æ„ / Refactored knowledge base to unified flat structure
  - æ‰€æœ‰æ–‡æ¡£ç»Ÿä¸€å­˜å‚¨åœ¨ unified/ ç›®å½• / All documents stored in unified/ directory
  - ç§»é™¤ç–¾ç—…åˆ†ç±»é™åˆ¶ / Removed disease category restrictions
  - æ–°å¢ UnifiedKnowledgeLoader æœåŠ¡ / Added UnifiedKnowledgeLoader service
  - è‡ªåŠ¨æ–‡æ¡£åˆ†ç±»å’Œæ ‡ç­¾æå– / Auto document categorization and tag extraction

Knowledge Base Workflow çŸ¥è¯†åº“å·¥ä½œæµ:
- ç®¡ç†ç«¯ä¸Šä¼  .md â†’ ä¿å­˜åˆ° unified/ â†’ åå°è‡ªåŠ¨å‘é‡åŒ–
- Admin uploads .md â†’ Save to unified/ â†’ Background auto-vectorization
- æ”¯æŒé‡å¤ä¸Šä¼ è¦†ç›–æ—§ç‰ˆæœ¬ / Support re-upload to overwrite old versions
- è‡ªåŠ¨æ£€æµ‹å’Œåˆ é™¤æ—§ chunks / Auto-detect and delete old chunks on re-upload

Bug Fixes Bugä¿®å¤:
- ä¿®å¤ MinerU Token åŠ¨æ€é…ç½®ä¸ç”Ÿæ•ˆ / Fixed MinerU token dynamic config not working
  - æ–°å¢ DynamicConfigService å®ç°è¿è¡Œæ—¶é…ç½®è¯»å–
  - æ–°å¢è¿è¡Œæ—¶é…ç½®è¯»å– / Added runtime config reading
  - Admin ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ / Changes effective immediately without restart
  
- ä¿®å¤å‘é‡åŒ–å¤±è´¥é—®é¢˜ / Fixed vectorization failures
  - ä¿®å¤ source_type enum ç¼ºå°‘ 'unified_kb' / Fixed missing 'unified_kb' in enum
  - ä¿®å¤é‡å¤ä¸Šä¼ æ—¶æ—§ chunks æœªåˆ é™¤ / Fixed old chunks not deleted on re-upload
  - ä¿®å¤æ ‡é¢˜åŒ¹é…é€»è¾‘æ”¯æŒå¸¦åç¼€çš„æ—§ç‰ˆæœ¬ / Fixed title matching for suffixed versions
  
- ä¿®å¤çŸ¥è¯†åº“ API ç«¯ç‚¹ / Fixed knowledge base API endpoints
  - æ›´æ–°æ–‡æ¡£åˆ—è¡¨è¯»å– unified ç›®å½• / Updated document list to read unified directory
  - ä¿®å¤åˆ é™¤ç«¯ç‚¹æ”¯æŒ unified ç»“æ„ / Fixed delete endpoint for unified structure
  - ä¿®å¤å¼‚æ­¥æ–‡ä»¶æ“ä½œ greenlet é”™è¯¯ / Fixed async file operation greenlet errors

Infrastructure åŸºç¡€è®¾æ–½:
- æ–°å¢ app/services/unified_kb_service.py / Added unified knowledge base service
- æ–°å¢ app/services/dynamic_config_service.py / Added dynamic config service
- æ–°å¢ app/services/document_tasks.py / Added background document processing
- æ›´æ–°æ–‡æ¡£ä¸Šä¼ åå°ä»»åŠ¡çœŸå®å‘é‡åŒ– / Updated upload to use real vectorization

Database æ•°æ®åº“:
- æ›´æ–° source_type enum: æ·»åŠ  'unified_kb' / Added 'unified_kb' to enum
- æ”¯æŒ knowledge_base_chunks æŒ‰æ ‡é¢˜æ¨¡ç³Šåˆ é™¤ / Support fuzzy delete by title

API Changes APIå˜æ›´:
- POST /api/v1/admin/knowledge-base/upload (å‘é‡åŒ–æµç¨‹æ›´æ–°)
- GET /api/v1/admin/knowledge-base/documents (è¯»å– unified ç›®å½•)
- DELETE /api/v1/admin/knowledge-base/documents/{id} (æ”¯æŒ unified ç»“æ„)
- åå°ä»»åŠ¡: _vectorize_knowledge_document (æ›¿æ¢æ—§ _process_knowledge_document)
```

## ğŸ“‹ è¯¦ç»†å˜æ›´ Detailed Changes

### 1. Unified Knowledge Base ç»Ÿä¸€çŸ¥è¯†åº“

**Before ä¹‹å‰:**
```
knowledge_bases/
â”œâ”€â”€ diseases/
â”‚   â”œâ”€â”€ digestive/
â”‚   â”œâ”€â”€ respiratory/
â”‚   â””â”€â”€ pediatric_bronchial_asthma/
â””â”€â”€ active/
```

**After ä¹‹å:**
```
knowledge_bases/
â””â”€â”€ unified/
    â”œâ”€â”€ metadata.json
    â”œâ”€â”€ æ€¥æ€§èƒƒè‚ ç‚è¯Šç–—æŒ‡å—.md
    â”œâ”€â”€ å„¿ç«¥æ”¯æ°”ç®¡å“®å–˜è§„èŒƒåŒ–è¯Šæ²»å»ºè®®_2020.md
    â””â”€â”€ ...
```

**Benefits ä¼˜åŠ¿:**
- ç®€åŒ–çŸ¥è¯†åº“ç®¡ç† / Simplified KB management
- æ”¯æŒä»»æ„ç–¾ç—…æ–‡æ¡£ / Support any disease documents
- è‡ªåŠ¨åˆ†ç±»å’Œæ ‡ç­¾ / Auto categorization and tags
- æ›´å¥½çš„æ‰©å±•æ€§ / Better scalability

### 2. MinerU Token Dynamic Configuration

**Problem é—®é¢˜:**
Admin ä¿®æ”¹ MinerU Token åéœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ

**Solution è§£å†³æ–¹æ¡ˆ:**
- DynamicConfigService ä»æ•°æ®åº“å®æ—¶è¯»å–é…ç½®
- MinerUService æ¯æ¬¡è°ƒç”¨å‰åˆ·æ–°é…ç½®
- æ”¯æŒ URL è‡ªåŠ¨æ ¡æ­£ (mineru.com â†’ mineru.net)

### 3. Vectorization Fixes

**Fixed Issues:**
1. PostgreSQL enum ç¼ºå°‘ 'unified_kb' å€¼
2. é‡å¤ä¸Šä¼ æ—¶æ—§ chunks æœªè¢«åˆ é™¤ (source_type ä¸åŒ¹é…)
3. æ ‡é¢˜åŒ¹é…ä¸æ”¯æŒå¸¦æ—¶é—´æˆ³åç¼€çš„æ—§ç‰ˆæœ¬
4. å¼‚æ­¥æ–‡ä»¶æ“ä½œå¯¼è‡´ greenlet_spawn é”™è¯¯

## ğŸ§ª æµ‹è¯• Test

æµ‹è¯•ç¯å¢ƒ / Test Environment:
- Docker Compose éƒ¨ç½² / Docker Compose deployment
- PostgreSQL 15 + Redis 7
- Python 3.12 + FastAPI

æµ‹è¯•ç”¨ä¾‹ / Test Cases:
âœ… ä¸Šä¼ æ–°æ–‡æ¡£ â†’ è‡ªåŠ¨å‘é‡åŒ–
âœ… é‡å¤ä¸Šä¼  â†’ è¦†ç›–æ—§ç‰ˆæœ¬
âœ… MinerU Token æ›´æ–° â†’ ç«‹å³ç”Ÿæ•ˆ
âœ… åˆ é™¤æ–‡æ¡£ â†’ æ¸…ç†æ–‡ä»¶å’Œå‘é‡
âœ… RAG æ£€ç´¢ â†’ è¿”å›æ­£ç¡® chunks

## ğŸ“ æ–‡æ¡£æ›´æ–° Documentation Updates

- æ›´æ–° README.md çŸ¥è¯†åº“è¯´æ˜
- æ–°å¢çŸ¥è¯†åº“æ¶æ„æ–‡æ¡£
- æ›´æ–° API æ–‡æ¡£

## ğŸ”§ é…ç½® Configuration

å‘é‡åŒ–é…ç½® / Vectorization Config:
```json
{
  "provider": "qwen",
  "model_id": "text-embedding-v3",
  "api_url": "https://dashscope.aliyuncs.com/api/v1/services/embeddings/text-embedding/text-embedding",
  "vector_dimension": 1024
}
```

## ğŸ“¦ éƒ¨ç½² Deployment

```bash
# 1. å¤‡ä»½æ•°æ®åº“
./scripts/backup.sh

# 2. æ›´æ–°ä»£ç 
git pull origin main

# 3. é‡å¯æœåŠ¡
docker-compose down
docker-compose up -d

# 4. éªŒè¯
./scripts/health-check.sh
```

## ğŸ› å·²çŸ¥é—®é¢˜ Known Issues

- é¦–æ¬¡é…ç½®å‘é‡åµŒå…¥æ¨¡å‹å‰ä¸Šä¼ æ–‡æ¡£ä¼šæ˜¾ç¤ºå¤±è´¥
  (éœ€åœ¨ Admin â†’ AIæ¨¡å‹è®¾ç½® ä¸­é…ç½® DashScope API Key)

## ğŸ™ è‡´è°¢ Credits

æ„Ÿè°¢æµ‹è¯•å›¢é˜Ÿçš„çŸ¥è¯†åº“é‡æ„æµ‹è¯•å’Œåé¦ˆã€‚

---

**Full Changelog**: https://github.com/yourusername/MediCare_AI/compare/v2.0.0...v2.0.1
