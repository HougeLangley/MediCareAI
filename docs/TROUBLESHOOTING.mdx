{/*
  Troubleshooting Guide | æ•…éšœæ’é™¤æŒ‡å—
  
  æœ¬æ–‡æ¡£è®°å½•å¸¸è§é—®é¢˜çš„åº”æ€¥å¤„ç†æ–¹æ¡ˆå’Œä¿®å¤è„šæœ¬
  This document records emergency solutions and fix scripts for common issues
*/}

# Troubleshooting Guide | æ•…éšœæ’é™¤æŒ‡å—

## æ¦‚è§ˆ Overview

æœ¬æ–‡æ¡£æä¾› MediCareAI ç³»ç»Ÿçš„å¸¸è§æ•…éšœæ’é™¤æŒ‡å—å’Œåº”æ€¥è„šæœ¬è¯´æ˜ã€‚

This document provides troubleshooting guides and emergency scripts for MediCareAI system.

---

## ğŸ†˜ åº”æ€¥è„šæœ¬ Emergency Scripts

### 1. Docker æ¸…ç†è„šæœ¬ Docker Cleanup Script

**æ–‡ä»¶ä½ç½® | Location**: `scripts/cleanup-docker.sh`

**ç”¨é€” | Purpose**:
æ¸…ç†æ‰€æœ‰ Docker æ•°æ®ï¼ŒåŒ…æ‹¬å®¹å™¨ã€å·ã€ç½‘ç»œã€‚ç”¨äºå®Œå…¨é‡ç½®ç¯å¢ƒã€‚

Clean all Docker data including containers, volumes, networks. Used for complete environment reset.

**ä½¿ç”¨åœºæ™¯ | When to Use**:
- å…¨æ–°éƒ¨ç½²å‰æ¸…ç†ç¯å¢ƒ
- Docker çŠ¶æ€å¼‚å¸¸éœ€è¦é‡ç½®
- ç£ç›˜ç©ºé—´ä¸è¶³éœ€è¦æ¸…ç†

**ä½¿ç”¨æ–¹æ³• | Usage**:
```bash
# äº¤äº’æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
./scripts/cleanup-docker.sh

# è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ï¼ˆéäº¤äº’å¼ï¼‰
./scripts/cleanup-docker.sh -y
# æˆ–
./scripts/cleanup-docker.sh --yes
```

**âš ï¸ è­¦å‘Š | Warning**:
æ­¤è„šæœ¬ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬æ•°æ®åº“ï¼ä½¿ç”¨å‰åŠ¡å¿…å¤‡ä»½ã€‚

This script deletes ALL data including databases! Backup before use.

---

## ğŸ”§ å¸¸è§é—®é¢˜ Common Issues

### é—®é¢˜ 1: PostgreSQL å¥åº·æ£€æŸ¥å¤±è´¥

**ç°è±¡ | Symptoms**:
```
medicare_postgres is unhealthy
```

**è§£å†³æ–¹æ¡ˆ | Solution**:
å·²åœ¨ `docker-compose.yml` ä¸­æ·»åŠ  `start_period: 60s` ç»™æ•°æ®åº“è¶³å¤Ÿçš„åˆå§‹åŒ–æ—¶é—´ã€‚

Already added `start_period: 60s` in `docker-compose.yml` for database initialization.

---

### é—®é¢˜ 2: Docker Compose å‘½ä»¤ä¸å…¼å®¹

**ç°è±¡ | Symptoms**:
```
docker-compose: command not found
```

**è§£å†³æ–¹æ¡ˆ | Solution**:
`scripts/cleanup-docker.sh` å·²å…¼å®¹ Docker Compose v1 (`docker-compose`) å’Œ v2 (`docker compose`)ã€‚

The cleanup script supports both Docker Compose v1 and v2.

---

### é—®é¢˜ 3: ç¯å¢ƒå˜é‡æœªåŒæ­¥åˆ°å®¹å™¨

**ç°è±¡ | Symptoms**:
ä¿®æ”¹ `.env` æ–‡ä»¶åï¼Œå®¹å™¨å†…çš„é…ç½®æœªæ›´æ–°ã€‚

**è§£å†³æ–¹æ¡ˆ | Solution**:
```bash
# é‡å¯åç«¯æœåŠ¡
docker-compose restart backend

# æˆ–è€…å®Œå…¨é‡æ–°åˆ›å»ºå®¹å™¨
docker-compose stop backend
docker-compose rm backend
docker-compose up -d backend
```

**åŸç† | Explanation**:
Docker çš„å·æŒ‚è½½å¯èƒ½éœ€è¦é‡å¯å®¹å™¨æ‰èƒ½åŒæ­¥æœ€æ–°çš„ `.env` æ–‡ä»¶å†…å®¹ã€‚

---

### é—®é¢˜ 4: é¦–æ¬¡éƒ¨ç½²æ•°æ®åº“è¿æ¥å¤±è´¥

**ç°è±¡ | Symptoms**:
```
Connection refused to PostgreSQL
```

**è§£å†³æ–¹æ¡ˆ | Solution**:
ç­‰å¾…æ•°æ®åº“å®Œå…¨å¯åŠ¨ï¼š
```bash
# æ£€æŸ¥ PostgreSQL å¥åº·çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs postgres

# ç­‰å¾…å¥åº·æ£€æŸ¥é€šè¿‡åé‡å¯åç«¯
docker-compose restart backend
```

---

## ğŸ“ ç»´æŠ¤ä»»åŠ¡ Maintenance Tasks

### å¤‡ä»½æ•°æ®åº“ Backup Database

```bash
# ä½¿ç”¨å†…ç½®å¤‡ä»½è„šæœ¬
./scripts/backup.sh

# æ‰‹åŠ¨å¤‡ä»½
docker exec medicare_postgres pg_dump -U medicare_user medicareai > backup_$(date +%Y%m%d).sql
```

### æŸ¥çœ‹æ—¥å¿— View Logs

```bash
# æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# ç‰¹å®šæœåŠ¡
docker-compose logs backend
docker-compose logs postgres
docker-compose logs redis

# å®æ—¶è·Ÿè¸ª
docker-compose logs -f backend
```

### é‡å¯æœåŠ¡ Restart Services

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
docker-compose restart postgres
```

---

## ğŸ› è°ƒè¯•æŠ€å·§ Debug Tips

### æ£€æŸ¥å®¹å™¨çŠ¶æ€ Check Container Status

```bash
docker-compose ps
docker stats
```

### è¿›å…¥å®¹å™¨è°ƒè¯• Enter Container for Debug

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker exec -it medicare_backend /bin/sh

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker exec -it medicare_postgres psql -U medicare_user -d medicareai
```

### æµ‹è¯• API Test API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost/health

# æµ‹è¯•ç™»å½•
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@medicare.ai","password":"admin123456"}'
```

---

## ğŸ“Š ç³»ç»Ÿèµ„æºç›‘æ§ System Resource Monitoring

### æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨ Container Resource Usage

```bash
docker stats
```

### æŸ¥çœ‹ç£ç›˜ä½¿ç”¨ Disk Usage

```bash
docker system df
docker system df -v
```

### æ¸…ç†æœªä½¿ç”¨èµ„æº Cleanup Unused Resources

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨èµ„æº
# è­¦å‘Šï¼šè¿™ä¼šåˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ã€æœªä½¿ç”¨çš„ç½‘ç»œã€é•œåƒå’Œæ„å»ºç¼“å­˜
docker system prune -a
```

---

## ğŸ” å®‰å…¨é…ç½® Security Configuration

### SELinux é—®é¢˜ SELinux Issues

å¦‚æœä½¿ç”¨ SELinux çš„ç³»ç»Ÿï¼ˆå¦‚ Fedoraã€RHELã€CentOSï¼‰é‡åˆ°æƒé™é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š

For SELinux-enabled systems (Fedora, RHEL, CentOS), see:

**ğŸ“„ [SELINUX-GUIDE.mdx](SELINUX-GUIDE.mdx)**

---

## ğŸ“ è·å–å¸®åŠ© Get Help

### æ–‡æ¡£èµ„æº Documentation Resources

- **[README.md](../README.md)** - é¡¹ç›®æ¦‚è§ˆå’Œå¿«é€Ÿå¼€å§‹
- **[DEPLOYMENT.mdx](DEPLOYMENT.mdx)** - è¯¦ç»†éƒ¨ç½²æŒ‡å—
- **[CHANGELOG.md](../CHANGELOG.md)** - ç‰ˆæœ¬å†å²è®°å½•

### æŠ¥å‘Šé—®é¢˜ Report Issues

å¦‚æœé‡åˆ°æœªåœ¨æ­¤æ–‡æ¡£ä¸­åˆ—å‡ºçš„é—®é¢˜ï¼š

1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`docker-compose logs [service]`
2. æ£€æŸ¥ [CHANGELOG.md](../CHANGELOG.md) äº†è§£å·²çŸ¥é—®é¢˜
3. åœ¨ GitHub Issues ä¸­æœç´¢ç±»ä¼¼é—®é¢˜
4. åˆ›å»ºæ–°çš„ Issue å¹¶æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—

---

**æœ€åæ›´æ–° | Last Updated**: 2026-02-16  
**ç‰ˆæœ¬ | Version**: v2.0.3  
**ç»´æŠ¤è€… | Maintainer**: è‹ä¸šé’¦ (Su Yeqin)
